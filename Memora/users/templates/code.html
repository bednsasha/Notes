{% load static %}
<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memora</title>
    <link href="{% static 'Bootstrap/bootstrap.min.css' %}" rel="stylesheet" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static 'font/Manrope/stylesheet.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">

    <script src="{% static 'Bootstrap/bootstrap.bundle.min.js'%}" crossorigin="anonymous"></script>

</head>

<body>
    <div class="authorization-all">
        <div class="background-authorization">
            <div class="wrapper">
                <div class="container">
                    <div class="banner-all">
                        <img src="{% static 'img/Logo_1.svg' %}" alt="Logo_1" class="logo-authorization">
                        <div class="text-banner">Твои идеи заслуживают идеального порядка</div>
                    </div>
                </div>
            </div>
        </div>

        <section class="form2">
            <a href="{% url 'users:registration' %}" class="arrow-link">
                <img src="{% static 'arrow-left.svg' %}" alt="arrow-left" class="arrow-icon">
            </a>

            <div class="code-text-top">
                <div class="text-cod">Код подтверждения</div>
                <div class="text-cod-2">Код подтверждения отправлен на указанную почту почту</div>
            </div>
            <form method="post">
    {% csrf_token %}
    <div class="code">
        <div class="container">
            <div class="row tight-grid justify-content-center">
                <div class="col-md-3">
                    <input type="text" name="n1" maxlength="1" class="form-control-code" required pattern="[0-9]">
                </div>
                <div class="col-md-3">
                    <input type="text" name="n2" maxlength="1" class="form-control-code" required pattern="[0-9]">
                </div>
                <div class="col-md-3">
                    <input type="text" name="n3" maxlength="1" class="form-control-code" required pattern="[0-9]">
                </div>
                <div class="col-md-3">
                    <input type="text" name="n4" maxlength="1" class="form-control-code" required pattern="[0-9]">
                </div>
            </div>
        </div>
    </div>

    <div class="timer-container">
        <span class="timer" id="timer">01:30</span>
        <a class="resend-link" id="resend">Отправить код повторно</a>
    </div>
    <div class="button-send">
        <button type="submit" class="btn btn-primary">Отправить</button>
    </div>
</form>


    </div>

    <script>

        let timeLeft = 60;
        const timerElement = document.getElementById('timer');
        const resendLink = document.getElementById('resend');

        function updateTimer() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;

            const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            timerElement.textContent = formattedTime;

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                timerElement.style.display = 'none';
                resendLink.style.display = 'inline';
            } else {
                timeLeft--;
            }
        }

        const timerInterval = setInterval(updateTimer, 1000);

        document.getElementById('resend').addEventListener('click', function(e) {
    e.preventDefault();
    fetch(window.location.href + 'resend/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({})
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Новый код отправлен на почту');
            // Можно сбросить таймер здесь
            document.getElementById('timer').textContent = '01:30';
        } else {
            alert('Ошибка при отправке кода');
        }
    })
    .catch(() => alert('Ошибка при отправке запроса'));
});

        updateTimer();
    </script>

    </section>
    </div>
</body>

</html>